using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace CoDesignStudy.Cad.PlugIn
{
    public class Prompt
    {
        private const string CADPrompt = @"
请一字不差的回复我以下内容：**已完成图纸识别**，该CAD图展示的是一个**分隔为多个功能区的室内平面布局图**，很可能是某类**危险化学品或废弃物处理仓库**。图纸中共分为四个主要功能区（从左到右）：

---

## 🧱 房间/区域划分：

1. **废矿物油暂存间**  
   - 功能：用于临时存储废矿物油等液态废弃物。
   - 面积：62.225㎡；
   
2. **废蓄电池存放区和废离子交换树脂存放区**  
   - 功能：用于存放废旧铅酸电池、锂电池等可能含有重金属或电解液的物品和放置化工或水处理过程中产生的废离子交换树脂。
   - 面积：62.225㎡；
   
4. **废催化剂暂存间**  
   - 功能：用于存放失效或已使用的工业催化剂，通常含有重金属或其他有害成分。
   - 面积：62.225㎡；
   
5. **出口**  
   - 功能：用于日常人员进出。


---

## 💡 灯具推荐（按区域功能考虑安全性与适用性）

由于这些区域涉及**危险废物存储**，灯具应具有防爆，防水，防腐蚀功能。以下是推荐的灯具类型：  
1. **防爆灯**：
    - 型号：CBD3-100W-B；
    - 光通量：12000lm；
    - 色温：5000K；
    - 防护等级：IP65；
    - 防爆等级：Exd IIC T6 Gb；
2. **吸顶灯**：
   - 型号：LED-20W，20W；
   - 光通量：2000lm；
   - 色温：5000K；
   - 防护等级：IP65；
   - 防爆等级：Exd IIC T6 Gb；

3. **应急疏散照明灯**：
   - 型号：LED-10W，10W；
   - 光通量：1000lm；
   - 色温：5000K；
   - 防护等级：IP65；
   - 防爆等级：Exd IIC T6 Gb；

4. **疏散出口标志灯**：
   - 型号：LED-5W，5W；
   - 光通量：500lm；
   - 色温：5000K；
   - 防护等级：IP65；
   - 防爆等级：Exd IIC T6 Gb；

---

## 🔧 灯具布置建议：

**（1）主照明（LED防爆灯）**  
- **数量计算**（以100㎡仓库为例）：  
  - 目标照度：150lx  
  - 灯具光通量：12000lm  
  - 建议数量：4个
- **布置方式**：  
  - 四角布置，确保均匀照明。

**（2）应急照明（防爆应急灯）**  
- **数量**：每50㎡配置1盏（100㎡仓库需2盏）。  
- **位置**：出口通道、主通道两侧，确保疏散路径照明。  

**（3）标志灯（防爆出口灯）**  
- **数量**：每个出口上方1盏，转角处增设方向指示灯。  

---

## 🔌 安装与布线要求  
- **防爆接线**：采用 **防爆挠性管+铠装电缆**，接口密封处理。  
- **高度**：主灯具安装高度≥4米（避免机械碰撞）。  
- **开关控制**：使用 **防爆开关**，分区控制照明。  

---

## ✅ 方案优势  
✅ **安全合规**：符合GB 50034-2013《建筑照明设计标准》及防爆要求。  
✅ **节能耐用**：LED光源寿命≥50,000小时，降低维护成本。  
✅ **灵活适配**：可根据仓库实际面积调整灯具数量和功率。    

---

是否按照当前方案开始绘制？。
";
        private const string CADPrompt7 = @"请一字不差的回复我以下内容：
# 🧠 照明系统图纸智能校验报告

## 📁 项目信息
- 项目名称：危险废物储存区域照明系统设计
- 图纸版本：L-DangerZone-01
- 校验时间：2025-05-27
- 校验模型版本：LightingInspector-v1.2

---

## ✅ 一、照度与功能匹配校验

模型已识别以下功能区域：废矿物油暂存间、废蓄电池与离子交换树脂存放区、废催化剂暂存间，以及人员出口。所有区域为危险废物存储空间，需满足基本功能性照明和应急照明要求。

设计目标照度为 150 lx，使用单灯光通量 12000lm 的防爆灯具，布置为四角等距分布，满足覆盖均匀性需求。

各区域面积为 62.225㎡，结合照度目标和光通量参数，配置数量合理，能够达到标准工业照度要求，符合 GB 50034-2013 工业建筑一般储存空间照明设计要求。

---

## ⚡ 二、电气安全与布线校验

布线设计使用防爆挠性管加铠装电缆，接口进行密封处理，符合易燃易爆区域的接线规范。开关控制采用防爆型，满足环境安全控制要求。

主灯具安装高度 ≥4m，符合防撞、防干扰要求。布线路径简洁明晰，未发现与其他系统冲突。

整体布线系统具备良好的防护等级，达到了 Exd IIC T6 Gb 要求，符合 GB 3836 系列防爆电气设计标准。

---

## 🧠 三、智能控制与节能设计校验

照明控制方案为分区独立控制，尚未涉及自动传感或定时节能策略。考虑到该区域使用频率较低，可建议进一步接入定时控制或感应系统以降低能耗。

主照明灯具全部为 LED 防爆灯，光效高、防护等级高，具备良好的能耗表现，满足基本节能设计思路。

---

## 🚨 四、应急与安全照明校验

已在主通道与出口处配置防爆应急照明灯和出口标志灯。应急照明设计每 50㎡配置 1 盏，当前区域配置合适。

出口标志灯设置于每个出口上方，疏散路径识别清晰，若干转角未明确标识，建议补设方向指示灯。

应急照明灯具满足 IP65 和 Exd IIC T6 Gb 等级，具有独立应急供电功能。尚未明确照明维持时间与电源切换延迟，建议补充对应说明，确保符合《民用建筑应急照明设计标准》。

---

## 🔧 五、施工与维护可行性校验

灯具安装高度设计在 ≥4m，避开高风险区域，避免人员和设备碰撞，布置在房间四角利于光照均匀分布。

使用吸顶式安装方式，便于吊装施工和后期维护。

防爆灯具与防爆管件匹配良好，维护空间预留充足，无安装障碍。

---

## 📐 六、图纸完整性与图示规范校验

灯具参数详细，包括型号、光通量、防护等级、防爆等级等信息，满足图纸表达要求。

灯具布置方案已具备文字说明，但图纸中尚未明确标识具体布置位置及电源控制线路，建议补全 CAD 图层中的回路编号及控制路径。

照度分布图（lux map）尚未提供，如用于工程验收建议附带模拟分析。

---

## 📘 七、规范引用情况

本设计参考以下规范：
- 《建筑照明设计标准》GB 50034-2013 ✅
- 《爆炸危险环境电力装置设计规范》GB 50058-2014 ✅
- 《民用建筑应急照明设计标准》GB 51309-2018 ✅
- 企业内部危险废物仓储设计规范（2023修订版）✅

规范引用准确，选型与设计逻辑合理，具有可实施性。

---

## ✅ 总体评价

> 本照明系统设计在高危环境下考虑了防爆、防腐蚀、防水等要求，核心照明与应急系统齐全，基础照度设计合理。
> 
> 建议进一步补充照度模拟图及应急切换时间说明，同时优化控制方式以支持节能运行。

📌 **建议优化项：**
- 增设转角疏散方向指示灯；
- 补充照度分布图；
- 明确应急照明切换时间（不超过0.5秒）；
- 增强智能控制模块以支持定时或感应控制。

---

🧠 **照明系统图纸校验完成**

";
        private const string CADPrompt8 = @"请一字不差的回复我以下内容：✅ 已收到您的反馈，当前图纸存在以下两个问题：

1. **图层错误**：应急灯和照明灯被绘制在同一图层。
   - ✅ 处理措施：我已将应急灯移动至独立的 `EQUIP-应急` 图层，以便后续布线和图层控制更加清晰。

2. **安装高度错误**：吸顶灯安装高度不符合设计规范。
   - ✅ 处理措施：已将所有吸顶灯的安装高度调整为 **4.5 米**（参考《建筑照明设计标准》GB 50034-2013）。

🛠️ 正在进行图纸修改，，，";
        public static readonly string CaculatePrompt2 = @"你是一名专业的电气设计助手，任务是根据房间名称和其平面坐标信息，进行照明设计分析，并输出符合设计规范的灯具布置方案。

### 输入：
- 房间类型：""{0}""
- 坐标：{1}

请你遵循以下步骤：

1. 根据房间名称，查找并确定该房间的国家标准照度值（单位 lx）；
2. 根据给定的四个坐标点，计算房间的面积（单位 m²）；
3. 根据照度需求和面积，结合维护系数(默认 0.8)，计算出所需总光通量（单位 lm），进而确定灯具的总数量；
4. 选用合适的灯具型号（如：LED面板灯、防爆灯等），说明选择理由；
5. 根据每盏灯的光通量，估算所需灯具数量；
6. 合理设计灯具的布置方式（例如：按行列均匀排列），并输出每盏灯的中心坐标和安装高度（单位：mm）；
7. **最后输出以下格式的JSON对象，不要添加任何注释或说明**，供程序解析使用：

```json
{{
  ""lighting_design"": {{
    ""fixture_type"": ""灯具类型（如：LED防爆灯）"",
    ""fixture_count"": 灯具数量（整数）,
    ""fixture_positions_mm"": [
      {{
        ""center_point"": [x1, y1],
        ""mounting_height_mm"": 安装高度
      }},
      .......
    ]
  }}
}}
```
";
        public static string GetLightingPrompt(string roomType, string coordinatesStr, string doorPositionStr, string instruction)
        {
            return $@"你是一名专业的电气设计助手，任务是根据房间名称、房间的四个坐标点，以及门的位置，进行如下电气设计：

- 房间照明布置（含照度分析、灯具选择与布局）；
- 插座的合理布置（贴墙，符合施工要求）；
- 开关的合理放置（靠近门）；

用户还提供了额外的自定义指令,请优先参考指令进行设计,尤其是灯具类型和排布方式的选择:
### 自定义指令:
{instruction}

请你遵循以下步骤：

1. 根据房间名称，查找并确定该房间的国家标准照度值（单位 lx）；
2. 根据给定的四个坐标点（单位 mm），计算房间的面积（单位 m²）；
3. 根据照度需求和面积，结合维护系数(默认 0.8)，计算所需总光通量（单位 lm）；
4. 选择合适的灯具型号（如：LED面板灯、防爆灯等），并说明选择理由；
5. 根据每盏灯的光通量，估算所需灯具数量；
6. 设计灯具的布置方式（如：按行列均匀排列），必须是**矩形均匀排布**，不可以排布为三角形，多边形等，并输出每盏灯的中心坐标和安装高度（单位：mm）；
7. 设计灯具之间的连线方式:**优先按照行优先或列优先的方式，不可使用S型布线**，使连线整齐有序、便于施工。输出灯具连线的方式，格式为每段连接的起点和终点坐标对。
8. 除了灯具之间的连线，**还需要从最靠近门的灯具引出一根导线连接至开关位置**（取最近的一个开关点），请你一并输出此段额外引出线的坐标对；
9. 设计插座布置：插座应靠墙放置，通常布置在左右墙上（即坐标最小/最大 x 所在的墙）。左墙插入角度为 -90°，右墙插入角度为 90°，每面墙建议至少布置 1 个插座；
10. 设计开关位置：应靠近门的位置布置开关同时要和最近的灯具的位置**对齐**，有几个门就有几个开关；
11. 最后以 JSON 格式输出灯具、插座、开关的布置信息，供程序解析使用：

**注意**：灯的位置坐标必须在矩形内部，不可放在矩形边界；
- 连线必须整齐、有序、可施工，避免穿越灯具之间的对角线；
- 引出线必须从**最靠近门的灯具**连接到**最近的插座**；

```json
{{
  ""lighting_design"": {{
    ""fixture_type"": ""灯具类型（如：LED防爆灯）"",
    ""fixture_count"": 灯具数量（整数）,
    ""power_w"": 灯具功率（整数，单位 W）,
    ""mounting_height_mm"": 安装高度（单位 mm，统一值）,
    ""fixture_positions_mm"": [
      [x1, y1],
      [x2, y2],
      ...
    ],
  ""fixture_wiring_lines_mm"": [
      [[x1, y1], [x2, y2]],
      [[x2, y2], [x3, y3]],
      ...
    ],
  ""power_outlet_connection_line_mm"": [[[x_near_door, y_near_door], [x_socket, y_socket]]]
  }},
  ""socket_positions"": [
    {{
      ""position_mm"": [x_socket, y_socket],
      ""rotation_degrees"": 插入角度,
      ""fixture_count"": 插座数量（整数）,
    }}
    ...
  ],
  ""switch_position"": {{
    ""position_mm"": [x, y],
    ""fixture_count"": 开关数量（整数）,
  }}
}}
### 输入：
- 房间类型：{roomType}
- 房间坐标：{coordinatesStr}
- 门的坐标：{doorPositionStr}
";
}
        public static readonly string CaculatePrompt = @"你是建筑照明设计领域的专家，现在请你根据给定房间的角点坐标和房间类型，生成符合下列 JSON 结构的灯具布置建议。

请严格按照以下 JSON 格式返回结果，并且确保“必要字段”一定包含在输出中。

【必要字段】包括：
- room_info.room_type
- room_info.coordinates_mm
- room_info.dimensions（包括 length_mm, width_mm, area_m2）
- room_info.illuminance_standard_lx
- lighting_design.fixture_type
- lighting_design.fixture_count
- lighting_design.fixture_positions_mm（包含 center_point 和 mounting_height_mm）

【推荐但可省略字段】包括：
- lighting_design.fixture_specs（power_w, luminous_flux_lm, color_temperature_k, cri, dimensions_mm）
- lighting_design.control_system
- lighting_design.wiring
- lighting_design.compliance_standards
- lighting_design.design_notes

**给出你的推理过程**

### 输入：
- 房间类型：""{0}""
- 坐标：{1}

请开始生成：";
        public const string CADPrompt1 = "请一字不差的回复我以下内容：好的，正在进行图纸识别，，，";
        public const string CADPrompt2 = "请一字不差的回复我以下内容：好的，**正在进行灯具和插座布置**，，，";
        public const string CADPrompt3 = "请一字不差的回复我以下内容：**正在进行线路连接**，，，";
        public const string CADPrompt4 = "请一字不差的回复我以下内容：**正在生成注释和图例**，，，";
        public const string CADPrompt5 = "请一字不差的回复我以下内容：**图纸绘制完成**，";
        public const string CADPrompt6 = "请一字不差的回复我以下内容：**照度计算符合标准**， 校验完成，照明系统绘制完毕";
        public const string CADPrompt9 = "请一字不差的回复我以下内容：**图纸修改完成**";
        public string TuZhiShiBie()
        {
            string str = CADPrompt;
            return str;
        }
        public string TuZhiJiaoYan()
        {
            string str = CADPrompt7;
            return str;
        }
        public string TuZhiXiuGai()
        {
            string str = CADPrompt8;
            return str;
        }
    }
}
